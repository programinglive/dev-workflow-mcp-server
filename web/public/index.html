<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dev Workflow Dashboard</title>
  <link rel="stylesheet" href="/output.css">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body class="bg-slate-50 text-slate-900">
  <div class="min-h-screen flex flex-col">
    <header class="border-b bg-gradient-to-r from-indigo-600 via-indigo-500 to-purple-500 text-white shadow-lg">
      <div class="max-w-7xl mx-auto px-6 py-6 flex flex-col gap-6 md:flex-row md:items-center md:justify-between">
        <div class="flex items-start gap-4">
          <div class="relative">
            <div class="absolute inset-0 rounded-2xl bg-white/20 blur-md"></div>
            <span
              class="relative inline-flex items-center justify-center h-14 w-14 rounded-2xl bg-white text-indigo-600 text-xl font-semibold shadow-lg">
              DW
            </span>
          </div>
          <div>
            <h1 class="text-3xl font-semibold flex items-center gap-3">
              <span
                class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-white/20 text-white shadow-sm">
                <i data-lucide="book-open"></i>
              </span>
              Dev Workflow Knowledge Hub
              <span id="appVersion"
                class="text-sm bg-white/20 px-2 py-0.5 rounded-full font-normal opacity-90 hidden"></span>
            </h1>
            <p class="text-sm md:text-base text-indigo-100/90 mt-2 max-w-xl">
              History, commands, and documentation unified into one dashboard so every task follows the disciplined
              workflow.
            </p>
            <div class="mt-4 flex flex-wrap gap-3 text-sm">
              <span class="inline-flex items-center gap-2 rounded-full bg-white/15 px-3 py-1"><i data-lucide="sparkles"
                  class="h-4 w-4"></i> Live insights</span>
              <span class="inline-flex items-center gap-2 rounded-full bg-white/15 px-3 py-1"><i data-lucide="workflow"
                  class="h-4 w-4"></i> Workflow guardrails</span>
              <span class="inline-flex items-center gap-2 rounded-full bg-white/15 px-3 py-1"><i
                  data-lucide="book-open-check" class="h-4 w-4"></i> Embedded documentation</span>
            </div>
          </div>
        </div>
        <div class="flex flex-col gap-4 md:items-end">
          <div class="flex items-center gap-3 w-full md:w-auto">
            <div class="relative flex-1 md:flex-initial">
              <i data-lucide="search"
                class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-indigo-300 h-4 w-4"></i>
              <input type="search" placeholder="Search sections" aria-label="Search sections"
                class="w-full pl-9 pr-4 py-2 rounded-full bg-white/20 text-white placeholder:text-indigo-200/80 focus:outline-none focus:ring-2 focus:ring-white/60 focus:bg-white/30"
                oninput="handleSectionSearch(event)" />
            </div>
            <button
              class="inline-flex items-center gap-2 rounded-full bg-white text-indigo-600 px-4 py-2 text-sm font-semibold shadow-md hover:bg-indigo-50"
              id="refreshDashboardBtn">
              <i data-lucide="refresh-ccw"></i>
              Refresh data
            </button>
          </div>
          <div class="flex flex-wrap gap-2 text-xs text-indigo-100/80 md:justify-end">
            <span class="inline-flex items-center gap-2"><i data-lucide="keyboard"></i> Press ‚¨áÔ∏è to navigate
              sections</span>
            <span class="inline-flex items-center gap-2"><i data-lucide="external-link"></i> Docs open inline</span>
          </div>
          <div class="flex flex-wrap gap-3 md:justify-end">
            <button
              class="scroll-link inline-flex items-center gap-2 rounded-full bg-white/15 px-3 py-1 text-sm font-medium hover:bg-white/25 transition"
              data-scroll-target="#overview"><i data-lucide="compass" class="h-4 w-4"></i> Overview</button>
            <button
              class="scroll-link inline-flex items-center gap-2 rounded-full bg-white/15 px-3 py-1 text-sm font-medium hover:bg-white/25 transition"
              data-scroll-target="#history"><i data-lucide="clock" class="h-4 w-4"></i> History</button>
            <button
              class="scroll-link inline-flex items-center gap-2 rounded-full bg-white/15 px-3 py-1 text-sm font-medium hover:bg-white/25 transition"
              data-scroll-target="#commands"><i data-lucide="workflow" class="h-4 w-4"></i> Commands</button>
            <button
              class="scroll-link inline-flex items-center gap-2 rounded-full bg-white/15 px-3 py-1 text-sm font-medium hover:bg-white/25 transition"
              data-scroll-target="#api"><i data-lucide="code" class="h-4 w-4"></i> API</button>
          </div>
        </div>
      </div>
    </header>

    <div class="flex flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 gap-6 py-8">
      <aside class="hidden lg:block w-64 shrink-0">
        <nav class="sticky top-24 bg-white border border-slate-200 rounded-lg p-4 space-y-4">
          <div>
            <h2 class="text-xs uppercase tracking-wide text-slate-500 mb-2">Documentation</h2>
            <ul class="space-y-1 text-sm" id="sidebarNav">
              <li><a href="#overview" class="block px-3 py-2 rounded hover:bg-indigo-50 text-slate-700">Overview</a>
              </li>
              <li><a href="#history" class="block px-3 py-2 rounded hover:bg-indigo-50 text-slate-700">Workflow
                  History</a></li>
              <li><a href="#usage" class="block px-3 py-2 rounded hover:bg-indigo-50 text-slate-700">Using Filters</a>
              </li>
              <li><a href="#commands" class="block px-3 py-2 rounded hover:bg-indigo-50 text-slate-700">Commands
                  Reference</a></li>
              <li><a href="#api" class="block px-3 py-2 rounded hover:bg-indigo-50 text-slate-700">API Endpoints</a>
              </li>
              <li><a href="#troubleshooting"
                  class="block px-3 py-2 rounded hover:bg-indigo-50 text-slate-700">Troubleshooting</a></li>
            </ul>
          </div>
          <div class="border-t pt-4">
            <h2 class="text-xs uppercase tracking-wide text-slate-500 mb-2">Resources</h2>
            <ul class="space-y-1 text-sm">
              <li><a href="https://github.com/programinglive/dev-workflow-mcp-server" target="_blank" rel="noopener"
                  class="block px-3 py-2 rounded hover:bg-indigo-50 text-indigo-600">GitHub Repository</a></li>
              <li><button data-doc="README.md"
                  class="doc-link block w-full text-left px-3 py-2 rounded hover:bg-indigo-50 text-indigo-600">Project
                  README</button></li>
              <li><button data-doc="web-dashboard.md"
                  class="doc-link block w-full text-left px-3 py-2 rounded hover:bg-indigo-50 text-indigo-600">Web
                  Dashboard Guide</button></li>
              <li><button data-doc="GETTING-STARTED.md"
                  class="doc-link block w-full text-left px-3 py-2 rounded hover:bg-indigo-50 text-indigo-600">Getting
                  Started</button></li>
              <li><button data-doc="EXAMPLES.md"
                  class="doc-link block w-full text-left px-3 py-2 rounded hover:bg-indigo-50 text-indigo-600">Examples</button>
              </li>
              <li><button data-doc="WORKFLOW-TEMPLATES.md"
                  class="doc-link block w-full text-left px-3 py-2 rounded hover:bg-indigo-50 text-indigo-600">Workflow
                  Templates</button></li>
              <li><button data-doc="TROUBLESHOOTING.md"
                  class="doc-link block w-full text-left px-3 py-2 rounded hover:bg-indigo-50 text-indigo-600">Troubleshooting</button>
              </li>
              <li><button data-doc="RELEASE_NOTES.md"
                  class="doc-link block w-full text-left px-3 py-2 rounded hover:bg-indigo-50 text-indigo-600">Release
                  Notes</button></li>
            </ul>
          </div>
        </nav>
      </aside>

      <main class="flex-1 space-y-12">
        <section id="overview" class="bg-white border border-slate-200 rounded-xl shadow-sm p-6">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-2xl font-semibold flex items-center gap-2">
                <i data-lucide="compass"></i>
                Overview
              </h2>
              <p class="mt-2 text-slate-600">Learn how the Dev Workflow dashboard surfaces workflow history and offers
                inline documentation for every MCP command.</p>
              <div class="mt-4 bg-amber-50 border border-amber-200 text-amber-800 text-sm rounded-lg p-4 flex gap-3">
                <i data-lucide="alert-circle" class="mt-1 shrink-0"></i>
                <p>
                  The dashboard is read-only. MCP clients (Windsurf, Claude Desktop, etc.) must launch the server via
                  <code>node index.js</code>
                  over stdio on the machine they control. Hosting this site publicly does <strong>not</strong> expose
                  the MCP protocol; without SSH or another
                  execution path to the server, remote users cannot connect their MCP agents.
                </p>
              </div>
            </div>
            <div class="hidden md:flex items-center gap-2 text-sm text-slate-500">
              <i data-lucide="info"></i>
              <span>Need help? Jump to <a href="#commands" class="text-indigo-600 underline">Commands
                  Reference</a>.</span>
            </div>
          </div>
          <div class="mt-6 grid gap-6 md:grid-cols-2">
            <div class="p-4 bg-indigo-50 rounded-lg border border-indigo-100">
              <h3 class="font-medium text-indigo-900 flex items-center gap-2"><i data-lucide="activity"></i> Live
                Insights</h3>
              <p class="text-sm text-indigo-900/80 mt-2">Connects directly to your `.state` history to show progress,
                release cadence, and team activity trends.</p>
            </div>
            <div class="p-4 bg-emerald-50 rounded-lg border border-emerald-100">
              <h3 class="font-medium text-emerald-900 flex items-center gap-2"><i data-lucide="book"></i> Built-in
                Playbook</h3>
              <p class="text-sm text-emerald-900/80 mt-2">Every MCP tool is documented with prerequisites, recommended
                usage, and follow-up actions.</p>
            </div>
          </div>
        </section>

        <section id="history" class="bg-white border border-slate-200 rounded-xl shadow-sm p-6 space-y-8">
          <div class="flex items-center justify-between flex-wrap gap-4">
            <div>
              <h2 class="text-2xl font-semibold flex items-center gap-2">
                <i data-lucide="clock-4"></i>
                Workflow History Explorer
              </h2>
              <p class="text-slate-600 mt-2">Slice and explore your task history. Use the filters below to focus on a
                user, time range, or frequency.</p>
            </div>
            <a href="#api" class="inline-flex items-center gap-2 text-sm text-indigo-600 hover:text-indigo-700">
              <i data-lucide="terminal"></i>
              View API
            </a>
          </div>

          <section id="filtersSection">
            <div class="bg-slate-50 border border-slate-200 rounded-lg p-6">
              <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <i data-lucide="sliders-horizontal"></i>
                Filters
              </h3>
              <div class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
                <label class="flex flex-col gap-1">
                  <span class="text-sm font-medium text-slate-600">User ID</span>
                  <input id="userId" type="text" placeholder="default"
                    class="border border-slate-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                </label>
                <label class="flex flex-col gap-1">
                  <span class="text-sm font-medium text-slate-600">Start date</span>
                  <input id="startDate" type="date"
                    class="border border-slate-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                </label>
                <label class="flex flex-col gap-1">
                  <span class="text-sm font-medium text-slate-600">End date</span>
                  <input id="endDate" type="date"
                    class="border border-slate-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                </label>
                <label class="flex flex-col gap-1">
                  <span class="text-sm font-medium text-slate-600">Activity frequency</span>
                  <select id="frequency"
                    class="border border-slate-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="daily">Daily</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                  </select>
                </label>
                <label class="flex flex-col gap-1">
                  <span class="text-sm font-medium text-slate-600">Page size</span>
                  <select id="pageSize"
                    class="border border-slate-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="10">10</option>
                    <option value="20" selected>20</option>
                    <option value="50">50</option>
                  </select>
                </label>
              </div>
              <div class="flex flex-wrap gap-3 items-center mt-5">
                <button id="applyFiltersBtn"
                  class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">Apply filters</button>
                <button id="resetFiltersBtn"
                  class="bg-white border border-slate-300 text-slate-700 px-4 py-2 rounded-md hover:bg-slate-100">Reset</button>
                <span class="text-sm text-slate-500">Leave fields empty to view all data for the default user.</span>
              </div>
            </div>
          </section>

          <section id="summarySection" class="hidden">
            <div class="bg-white border border-slate-200 rounded-lg p-6 shadow-inner">
              <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <i data-lucide="bar-chart-2"></i>
                Project Summary
              </h3>
              <div id="summaryContent" class="space-y-2 text-sm"></div>
              <div id="historySummaryCard" class="mt-6 bg-slate-50 border border-slate-200 rounded-md p-4 hidden">
                <div class="flex items-center justify-between mb-2">
                  <h4 class="font-medium text-slate-700" id="historySummaryHeading">Activity by period</h4>
                  <span class="text-xs uppercase tracking-wide text-slate-500" id="historySummaryMeta"></span>
                </div>
                <div id="historySummaryContent" class="space-y-1 text-sm text-slate-700"></div>
              </div>
            </div>
          </section>

          <section id="historySection" class="hidden">
            <div class="bg-white border border-slate-200 rounded-lg p-6 shadow-inner">
              <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <i data-lucide="history"></i>
                Recent History
              </h3>
              <div id="historyContent" class="space-y-3 text-sm"></div>
              <div id="paginationControls" class="flex items-center justify-between mt-6 hidden">
                <button id="prevPageBtn"
                  class="bg-white border border-slate-300 text-slate-700 px-3 py-1 rounded-md hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed">Previous</button>
                <span id="pageInfo" class="text-sm text-slate-600"></span>
                <button id="nextPageBtn"
                  class="bg-white border border-slate-300 text-slate-700 px-3 py-1 rounded-md hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed">Next</button>
              </div>
            </div>
          </section>
        </section>

        <section id="usage" class="bg-white border border-slate-200 rounded-xl shadow-sm p-6">
          <div class="flex items-center gap-2 text-indigo-600 text-sm font-medium uppercase tracking-wide">
            <i data-lucide="target"></i>
            How to Use the Dashboard
          </div>
          <div class="mt-4 grid gap-6 md:grid-cols-2">
            <div>
              <h3 class="font-semibold text-slate-800">1. Filter your scope</h3>
              <p class="text-sm text-slate-600 mt-2">Pick a user ID to analyze individual contributions. Add date ranges
                to focus on a release window, sprint, or quarter.</p>
            </div>
            <div>
              <h3 class="font-semibold text-slate-800">2. Inspect the summary</h3>
              <p class="text-sm text-slate-600 mt-2">Review overall throughput, mix of task types, and recent activity.
                The summary auto-updates whenever you change filters.</p>
            </div>
            <div>
              <h3 class="font-semibold text-slate-800">3. Dive into entries</h3>
              <p class="text-sm text-slate-600 mt-2">Scroll the event log to see commit messages, forced completions,
                and dropped tasks. Use pagination to traverse older work.</p>
            </div>
            <div>
              <h3 class="font-semibold text-slate-800">4. Export via API</h3>
              <p class="text-sm text-slate-600 mt-2">Need automation or reporting? Jump to the <a href="#api"
                  class="text-indigo-600 underline">API section</a> and query JSON endpoints directly.</p>
            </div>
          </div>
        </section>

        <section id="commands" class="bg-white border border-slate-200 rounded-xl shadow-sm p-6 space-y-6">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div>
              <h2 class="text-2xl font-semibold flex items-center gap-2">
                <i data-lucide="workflow"></i>
                Commands Reference
              </h2>
              <div
                class="mt-2 inline-flex items-center gap-2 rounded-full bg-indigo-50 px-3 py-1 text-xs font-semibold text-indigo-600 uppercase tracking-wide">
                <i data-lucide="check-square"></i>
                <span>All Tools ¬∑ 20 commands</span>
              </div>
              <p class="text-slate-600 mt-3">Explore all <strong>20</strong> MCP tools that keep the workflow honest.
                Review prerequisites, usage tips, and next steps for each command below.</p>
            </div>
            <button data-doc="README.md" data-doc-heading="üõ†Ô∏è Available Tools"
              class="doc-link inline-flex items-center gap-2 text-sm text-indigo-600 hover:text-indigo-700">
              <i data-lucide="external-link"></i>
              Full README Reference
            </button>
          </div>

          <div class="space-y-4">
            <details open class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="flag"></i> start_task</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Begin every effort with a clear description and task type.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> <code>description</code> (string, required), <code>type</code>
                    ("feature" | "bugfix" | "refactor" | "other", required)</li>
                  <li><strong>When to use:</strong> Before writing code or touching files.</li>
                  <li><strong>Next step:</strong> Implement your changes then run <code>mark_bug_fixed</code>.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="check-circle"></i> mark_bug_fixed</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Declare the implementation complete and explain what was delivered.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameter:</strong> <code>summary</code> (string, required)</li>
                  <li><strong>Prerequisite:</strong> Code changes ready for testing.</li>
                  <li><strong>Next step:</strong> Create or update automated tests.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="beaker"></i> create_tests</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Confirm that coverage exists for the work you just completed.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> None.</li>
                  <li><strong>When to use:</strong> After <code>mark_bug_fixed</code> once tests are written.</li>
                  <li><strong>Next step:</strong> Execute <code>run_tests</code> and record the results.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="ban"></i> skip_tests</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Document why automated tests are impossible for this task.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameter:</strong> <code>reason</code> (string, required)</li>
                  <li><strong>Effect:</strong> Flags the workflow for manual QA review.</li>
                  <li><strong>Next step:</strong> Continue with <code>create_documentation</code>.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="test-tube"></i> run_tests</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Capture the outcome of your automated test run.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> <code>passed</code> (boolean, required), <code>testCommand</code>
                    (string, required), optional <code>details</code> (string)</li>
                  <li><strong>Guidance:</strong> Never proceed if tests fail‚Äîreturn to coding and re-run.</li>
                  <li><strong>Next step:</strong> Move to <code>create_documentation</code> when green.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="file-text"></i> create_documentation</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Record documentation updates before proceeding to verification.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> <code>documentationType</code> (enum), <code>summary</code> (string)
                  </li>
                  <li><strong>Tip:</strong> Keep summaries short but action-oriented. Include links to README sections
                    or docs PRs.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="shield-check"></i> check_ready_to_commit</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Run the automated readiness review. This ensures each phase is complete before you commit.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Output:</strong> Highlights missing steps and pending verification.</li>
                  <li><strong>Next step:</strong> <code>commit_and_push</code> when the ready check passes.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="git-commit"></i> commit_and_push</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Automatically stage, commit, and push once verification passes.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> <code>commitMessage</code> (string), optional <code>branch</code>
                    (string)</li>
                  <li><strong>Behavior:</strong> Detects clean working trees and reuses the latest commit metadata.</li>
                  <li><strong>Reminder:</strong> Any new edits will bounce you back to this step.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="rocket"></i> perform_release</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Record release details once the commit is live. Guards ensure the workflow order.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> <code>command</code> (string), optional <code>notes</code>,
                    <code>releaseType</code>, <code>preset</code>
                  </li>
                  <li><strong>Integration:</strong> Wraps <code>release-wrapper.js</code> to prevent accidental version
                    bumps.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="check-square"></i> complete_task</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Close the workflow after a successful push and release.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameter:</strong> <code>commitMessage</code> (string, required)</li>
                  <li><strong>Effect:</strong> Archives the task in history and resets the state.</li>
                  <li><strong>Next step:</strong> Celebrate or begin the next task with <code>start_task</code>.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="alert-triangle"></i> force_complete_task</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Record an incomplete task as finished with a justification.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> optional <code>commitMessage</code>, optional <code>reason</code>
                    (string)</li>
                  <li><strong>Use sparingly:</strong> Ideal for emergencies where remaining steps cannot be done.</li>
                  <li><strong>Next step:</strong> Follow up manually on outstanding work.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="x-circle"></i> drop_task</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Abandon the current effort while keeping the history clean.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameter:</strong> optional <code>reason</code> (string)</li>
                  <li><strong>When to use:</strong> Pivoting to a new approach or discarding exploratory work.</li>
                  <li><strong>Next step:</strong> Start a fresh task once direction is clear.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="info"></i> get_workflow_status</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Check the current phase, pending steps, and metadata.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> None.</li>
                  <li><strong>Use when:</strong> You need a quick reminder of what remains.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="history"></i> view_history</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>List recently completed tasks and their outcomes.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameter:</strong> optional <code>limit</code> (number)</li>
                  <li><strong>Great for:</strong> Standups, retrospectives, or auditing recent work.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="compass"></i> continue_workflow</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Receive coaching on what to do next.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> None.</li>
                  <li><strong>Behavior:</strong> Runs readiness checks automatically and surfaces blockers.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="refresh-cw"></i> rerun_workflow</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Reset the active task back to the start.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> None.</li>
                  <li><strong>Use when:</strong> You want to replay the entire process with fresh inputs.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="workflow"></i> run_full_workflow</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Execute every command in sequence when you already know the answers.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters (required):</strong> <code>summary</code>, <code>testCommand</code>,
                    <code>documentationType</code>, <code>documentationSummary</code>, <code>commitMessage</code>,
                    <code>releaseCommand</code>
                  </li>
                  <li><strong>Optional:</strong> <code>testsPassed</code>, <code>testDetails</code>,
                    <code>branch</code>, <code>releaseNotes</code>, <code>releaseType</code>, <code>preset</code>
                  </li>
                  <li><strong>Ideal for:</strong> Scripted flows or demos where you want the guardrails without manual
                    calls.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="pie-chart"></i> project_summary</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Generate a high-level recap of the project‚Äôs workflow health.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> None.</li>
                  <li><strong>Output:</strong> Aggregated stats compiled from workflow history.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="database"></i> project_summary_data</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Read the persisted JSON knowledge base (project-summary.json).</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> None.</li>
                  <li><strong>Use when:</strong> You need the structured summary file for automation or reporting.</li>
                </ul>
              </div>
            </details>

            <details class="border border-slate-200 rounded-lg">
              <summary class="cursor-pointer select-none px-4 py-3 flex items-center justify-between font-medium">
                <span><i data-lucide="database-backup"></i> project_summary_db</span>
                <i data-lucide="chevron-down" class="ml-2"></i>
              </summary>
              <div class="px-5 pb-5 space-y-3 text-sm text-slate-600">
                <p>Query the SQLite-backed knowledge base for the active user.</p>
                <ul class="list-disc list-inside space-y-1">
                  <li><strong>Parameters:</strong> None.</li>
                  <li><strong>Tip:</strong> Set <code>DEV_WORKFLOW_USER_ID</code> to target another user‚Äôs dataset.</li>
                </ul>
              </div>
            </details>
          </div>
        </section>

        <section id="api" class="bg-white border border-slate-200 rounded-xl shadow-sm p-6 space-y-6">
          <div class="flex items-center gap-2 text-indigo-600 text-sm font-medium uppercase tracking-wide">
            <i data-lucide="code"></i>
            API Endpoints
          </div>
          <p class="text-slate-600">Use these JSON endpoints to integrate task history into automation, dashboards, or
            reports.</p>
          <div class="space-y-4 text-sm text-slate-700">
            <div class="border border-slate-200 rounded-lg p-4">
              <h3 class="font-medium text-slate-800">GET /api/summary</h3>
              <p class="mt-1">Aggregate stats (totals, task mix, recent activity).</p>
              <p class="mt-2 text-xs text-slate-500">Query params: <code>user</code></p>
            </div>
            <div class="border border-slate-200 rounded-lg p-4">
              <h3 class="font-medium text-slate-800">GET /api/history</h3>
              <p class="mt-1">Paginated timeline of workflow entries with commit metadata.</p>
              <p class="mt-2 text-xs text-slate-500">Query params: <code>user</code>, <code>page</code>,
                <code>pageSize</code>, <code>startDate</code>, <code>endDate</code>
              </p>
            </div>
            <div class="border border-slate-200 rounded-lg p-4">
              <h3 class="font-medium text-slate-800">GET /api/history-summary</h3>
              <p class="mt-1">Counts per day, month, or year for trend analysis.</p>
              <p class="mt-2 text-xs text-slate-500">Query params: <code>user</code>, <code>frequency</code>,
                <code>startDate</code>, <code>endDate</code>
              </p>
            </div>
          </div>
        </section>

        <section id="troubleshooting" class="bg-white border border-slate-200 rounded-xl shadow-sm p-6">
          <div class="flex items-center gap-2 text-rose-600 text-sm font-medium uppercase tracking-wide">
            <i data-lucide="life-buoy"></i>
            Troubleshooting
          </div>
          <div class="mt-4 overflow-hidden border border-slate-200 rounded-lg">
            <table class="min-w-full divide-y divide-slate-200 text-sm">
              <thead class="bg-slate-50 text-slate-600 uppercase text-xs tracking-wide">
                <tr>
                  <th class="px-4 py-3 text-left">Symptom</th>
                  <th class="px-4 py-3 text-left">Resolution</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-100">
                <tr>
                  <td class="px-4 py-3">Dashboard shows empty data</td>
                  <td class="px-4 py-3">Verify the MCP server has created `.state/users/<user>/workflow-state.json` and
                      that the selected user matches.</td>
                </tr>
                <tr>
                  <td class="px-4 py-3">`better-sqlite3` build error on startup</td>
                  <td class="px-4 py-3">Install Python 3 and native build tools (Windows) or ensure SQLite headers are
                    installed (macOS/Linux).</td>
                </tr>
                <tr>
                  <td class="px-4 py-3">Port already in use</td>
                  <td class="px-4 py-3">Set <code>DEV_WORKFLOW_WEB_PORT</code> to a free port before running
                    <code>npm run web</code>.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
      </main>
    </div>
  </div>

  <div id="docModal" class="fixed inset-0 hidden z-50">
    <div class="absolute inset-0 bg-slate-900/70" id="docModalBackdrop"></div>
    <div class="relative h-full w-full overflow-y-auto p-4 md:p-8">
      <div class="max-w-5xl mx-auto bg-white rounded-xl shadow-2xl border border-slate-200">
        <header
          class="flex items-center justify-between px-6 md:px-8 py-5 border-b border-slate-200 bg-gradient-to-r from-indigo-50 to-white">
          <div>
            <h3 id="docModalTitle" class="text-xl font-bold text-slate-900"></h3>
            <p id="docModalSubtitle" class="text-sm text-slate-600 mt-1"></p>
          </div>
          <button id="docModalClose"
            class="p-2.5 rounded-lg text-slate-500 hover:text-slate-700 hover:bg-white/80 transition-colors shadow-sm"
            aria-label="Close documentation">
            <i data-lucide="x"></i>
          </button>
        </header>
        <article id="docModalContent" class="prose prose-slate prose-lg max-w-none px-6 md:px-12 py-8 md:py-10">
          <p class="text-sm text-slate-500">Loading‚Ä¶</p>
        </article>
      </div>
    </div>
  </div>

  <script type="module">
    window.handleSectionSearch = (event) => {
      const query = event.target.value.trim().toLowerCase();
      const links = Array.from(document.querySelectorAll('#sidebarNav a'));
      links.forEach((link) => {
        const match = link.textContent.toLowerCase().includes(query);
        link.classList.toggle('hidden', query && !match);
      });
    };

    function el(id) { return document.getElementById(id); }

    const frequencyLabels = {
      daily: "Daily",
      monthly: "Monthly",
      yearly: "Yearly",
    };

    const state = {
      userId: "",
      startDate: "",
      endDate: "",
      frequency: "daily",
      page: 1,
      pageSize: 20,
      totalPages: 1,
    };

    const controls = {
      userId: el("userId"),
      startDate: el("startDate"),
      endDate: el("endDate"),
      frequency: el("frequency"),
      pageSize: el("pageSize"),
      applyFilters: el("applyFiltersBtn"),
      resetFilters: el("resetFiltersBtn"),
      prevPage: el("prevPageBtn"),
      nextPage: el("nextPageBtn"),
      pageInfo: el("pageInfo"),
      pagination: el("paginationControls"),
      historySummaryCard: el("historySummaryCard"),
      historySummaryContent: el("historySummaryContent"),
      historySummaryMeta: el("historySummaryMeta"),
    };

    function formatSummary(data) {
      if (!data) return '<p class="text-gray-500">No summary available.</p>';
      const taskTypes = Object.entries(data.taskTypes || {}).map(([t, c]) => `${t}: ${c}`).join(', ');
      const recent = (data.recentTasks || []).map(t => `<li>${t.description} (${t.type})</li>`).join('');
      return `
        <div><strong>Total tasks:</strong> ${data.totalTasks}</div>
        <div><strong>Task mix:</strong> ${taskTypes || '‚Äî'}</div>
        <div><strong>Last active:</strong> ${data.lastActive ? new Date(data.lastActive).toLocaleDateString() : 'Never'}</div>
        <div><strong>Updated:</strong> ${data.updatedAt ? new Date(data.updatedAt).toLocaleString() : '‚Äî'}</div>
        <div class="mt-4"><strong>Recent tasks:</strong><ul class="list-disc list-inside">${recent || '<li>No recent tasks</li>'}</ul></div>
      `;
    }

    function formatHistory(rows) {
      if (!rows || rows.length === 0) return '<p class="text-gray-500">No history yet.</p>';
      return rows.map(row => `
        <div class="border-b pb-2">
          <div class="flex justify-between items-start">
            <div>
              <div class="font-medium">${row.task_description}</div>
              <div class="text-sm text-gray-600">${row.task_type} ‚Ä¢ ${new Date(row.timestamp).toLocaleString()}</div>
              <div class="text-sm text-gray-500">Commit: ${row.commit_message || '(none)'}</div>
            </div>
            ${row.forced ? '<span class="text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded">Forced</span>' : ''}
            ${row.dropped ? '<span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">Dropped</span>' : ''}
          </div>
        </div>
      `).join('');
    }

    function formatHistorySummary(series) {
      if (!series || series.length === 0) {
        return '<p class="text-gray-500">No activity for the selected range.</p>';
      }
      return series.map(item => `
        <div class="flex justify-between">
          <span>${item.period}</span>
          <span class="font-medium">${item.count}</span>
        </div>
      `).join('');
    }

    async function fetchJson(path, params = {}) {
      const url = new URL(path, window.location.origin);
      Object.entries(params).forEach(([key, value]) => {
        if (value !== undefined && value !== null && value !== '') {
          url.searchParams.set(key, value);
        }
      });
      const res = await fetch(url.toString());
      if (!res.ok) {
        throw new Error(`Request failed: ${res.status}`);
      }
      return res.json();
    }

    function collectFilters() {
      state.userId = controls.userId.value.trim();
      state.startDate = controls.startDate.value;
      state.endDate = controls.endDate.value;
      state.frequency = controls.frequency.value;
      state.pageSize = Number(controls.pageSize.value) || 20;
    }

    function resetFilters() {
      controls.userId.value = "";
      controls.startDate.value = "";
      controls.endDate.value = "";
      controls.frequency.value = "daily";
      controls.pageSize.value = "20";
      state.userId = "";
      state.startDate = "";
      state.endDate = "";
      state.frequency = "daily";
      state.page = 1;
      state.pageSize = 20;
      load();
    }

    function updatePagination(total, page, pageSize) {
      const totalPages = Math.max(1, Math.ceil(total / pageSize));
      state.totalPages = totalPages;
      controls.pageInfo.textContent = `Page ${page} of ${totalPages} (${total} entries)`;
      controls.prevPage.disabled = page <= 1;
      controls.nextPage.disabled = page >= totalPages;
      controls.pagination.classList.toggle("hidden", total === 0);
    }

    function updateHistorySummary(series) {
      if (!series || series.length === 0) {
        controls.historySummaryCard.classList.add("hidden");
        controls.historySummaryContent.innerHTML = "";
        return;
      }
      controls.historySummaryContent.innerHTML = formatHistorySummary(series);
      const freqLabel = frequencyLabels[state.frequency] || "Daily";
      const rangeParts = [];
      if (state.startDate) rangeParts.push(`from ${state.startDate}`);
      if (state.endDate) rangeParts.push(`to ${state.endDate}`);
      controls.historySummaryMeta.textContent = `${freqLabel}${rangeParts.length ? ` ‚Ä¢ ${rangeParts.join(" ")}` : ""}`;
      controls.historySummaryCard.classList.remove("hidden");
    }

    async function load() {
      const userId = state.userId || "default";

      // Fetch version
      fetchJson('/api/version').then(({ version }) => {
        const verEl = el('appVersion');
        if (verEl && version) {
          verEl.textContent = `v${version}`;
          verEl.classList.remove('hidden');
        }
      }).catch(() => { }); // Ignore version fetch errors

      try {
        const historyParams = {
          user: userId,
          page: state.page,
          pageSize: state.pageSize,
          startDate: state.startDate,
          endDate: state.endDate,
        };
        const summaryParams = {
          user: userId,
          startDate: state.startDate,
          endDate: state.endDate,
          frequency: state.frequency,
        };
        const [{ summary }, historyData, { summary: historySummary }] = await Promise.all([
          fetchJson('/api/summary', { user: userId }),
          fetchJson('/api/history', historyParams),
          fetchJson('/api/history-summary', summaryParams),
        ]);

        el('summaryContent').innerHTML = formatSummary(summary);
        el('historyContent').innerHTML = formatHistory(historyData.entries);
        updatePagination(historyData.total, historyData.page, historyData.pageSize);
        updateHistorySummary(historySummary);

        el('summarySection').classList.remove('hidden');
        el('historySection').classList.remove('hidden');
      } catch (error) {
        el('summaryContent').innerHTML = `<p class="text-red-500">Failed to load summary: ${error.message}</p>`;
        el('historyContent').innerHTML = '<p class="text-gray-500">History unavailable.</p>';
        controls.pagination.classList.add("hidden");
        controls.historySummaryCard.classList.add("hidden");
        el('summarySection').classList.remove('hidden');
        el('historySection').classList.remove('hidden');
      }
    }

    controls.applyFilters.addEventListener('click', () => {
      collectFilters();
      state.page = 1;
      load();
    });
    controls.resetFilters.addEventListener('click', resetFilters);
    controls.userId.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        collectFilters();
        state.page = 1;
        load();
      }
    });
    controls.prevPage.addEventListener('click', () => {
      if (state.page > 1) {
        state.page -= 1;
        load();
      }
    });
    controls.nextPage.addEventListener('click', () => {
      if (state.page < state.totalPages) {
        state.page += 1;
        load();
      }
    });

    const docModal = el('docModal');
    const docModalContent = el('docModalContent');
    const docModalTitle = el('docModalTitle');
    const docModalSubtitle = el('docModalSubtitle');
    const docModalClose = el('docModalClose');
    const docModalBackdrop = el('docModalBackdrop');

    function closeDocModal() {
      docModal.classList.add('hidden');
      docModalContent.innerHTML = '<p class="text-sm text-slate-500">Loading‚Ä¶</p>';
      docModalSubtitle.textContent = '';
    }

    async function openDocModal(docKey, headingText) {
      try {
        docModal.classList.remove('hidden');
        docModalTitle.textContent = docKey;
        docModalContent.innerHTML = '<p class="text-sm text-slate-500">Loading‚Ä¶</p>';
        const response = await fetch(`/api/docs?doc=${encodeURIComponent(docKey)}`);
        if (!response.ok) {
          throw new Error(`Failed to load document (${response.status})`);
        }
        const payload = await response.json();
        const rawContent = payload.content || '';
        const format = (payload.format || 'markdown').toLowerCase();
        const html = format === 'html' ? rawContent : marked.parse(rawContent);
        docModalContent.innerHTML = html;

        lucide.createIcons();

        if (headingText) {
          const headings = docModalContent.querySelectorAll('h1, h2, h3, h4, h5, h6');
          for (const heading of headings) {
            if (heading.textContent.trim().toLowerCase().includes(headingText.toLowerCase())) {
              heading.classList.add('bg-indigo-50', 'border-l-4', 'border-indigo-400', 'pl-3', 'py-1');
              heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
              docModalSubtitle.textContent = `Jumped to section: ${heading.textContent.trim()}`;
              break;
            }
          }
        }
      } catch (error) {
        docModalContent.innerHTML = `<p class="text-sm text-rose-600">${error.message}</p>`;
      }
    }

    document.querySelectorAll('.doc-link').forEach((button) => {
      button.addEventListener('click', () => {
        const docKey = button.dataset.doc;
        const heading = button.dataset.docHeading;
        openDocModal(docKey, heading);
      });
    });

    document.querySelectorAll('.scroll-link').forEach((button) => {
      button.addEventListener('click', () => {
        const target = button.dataset.scrollTarget;
        if (!target) return;
        const elTarget = document.querySelector(target);
        if (elTarget) {
          elTarget.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });

    docModalClose.addEventListener('click', closeDocModal);
    docModalBackdrop.addEventListener('click', closeDocModal);
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && !docModal.classList.contains('hidden')) {
        closeDocModal();
      }
    });

    const refreshButton = document.getElementById('refreshDashboardBtn');
    if (refreshButton) {
      refreshButton.addEventListener('click', () => {
        collectFilters();
        state.page = 1;
        load();
      });
    }

    // Initialize Lucide icons and initial load
    lucide.createIcons();
    collectFilters();
    load();
  </script>
</body>

</html>